<!-- Created using vQmod XML Generator by UKSB - http://www.opencart-extensions.co.uk //-->
<modification>
	<id><![CDATA[PDF order in confirmation mail]]></id>
	<version><![CDATA[1.0]]></version>
	<vqmver><![CDATA[2.5.1]]></vqmver>
	<author><![CDATA[Andrej Ruman]]></author>
	<file name="admin/language/slovak/setting/setting.php">
		<operation>
			<search position="after"><![CDATA[$_['entry_alert_emails']]]></search>
			<add><![CDATA[$_['entry_email_body'] = 'Text email-u potvrdenia objednávky'; ]]></add>
		</operation>
	</file>
	<file name="admin/controller/setting/setting.php">
		<operation>
			<search position="after" offset="5"><![CDATA[isset($this->request->post['config_alert_emails'])]]></search>
			<add><![CDATA[if (isset($this->request->post['config_email_body'])) {
	$this->data['config_email_body'] = $this->request->post['config_email_body'];
} else {$this->data['config_email_body'] = $this->config->get('config_email_body');}]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[$this->data['entry_alert_emails'] = $this->language->get('entry_alert_emails');]]></search>
			<add><![CDATA[$this->data['entry_email_body'] = $this->language->get('entry_email_body');]]></add>
		</operation>
	</file>
	<file name="admin/view/template/setting/setting.tpl">
		<operation>
			<search position="after" offset="1"><![CDATA[<td><textarea name="config_alert_emails"]]></search>
			<add><![CDATA[<tr>
			  <td><?php echo $entry_email_body; ?></td>
              <td><textarea name="config_email_body" id="email_body_text"><?php echo $config_email_body; ?></textarea></td>
			</tr>]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[<?php echo $footer; ?>]]></search>
			<add><![CDATA[<script type="text/javascript" src="view/javascript/ckeditor/ckeditor.js"></script> 
<script type="text/javascript"><!--
CKEDITOR.replace('email_body_text', {
	filebrowserBrowseUrl: 'index.php?route=common/filemanager&token=<?php echo $token; ?>',
	filebrowserImageBrowseUrl: 'index.php?route=common/filemanager&token=<?php echo $token; ?>',
	filebrowserFlashBrowseUrl: 'index.php?route=common/filemanager&token=<?php echo $token; ?>',
	filebrowserUploadUrl: 'index.php?route=common/filemanager&token=<?php echo $token; ?>',
	filebrowserImageUploadUrl: 'index.php?route=common/filemanager&token=<?php echo $token; ?>',
	filebrowserFlashUploadUrl: 'index.php?route=common/filemanager&token=<?php echo $token; ?>'
});
//--></script> ]]></add>
		</operation>
	</file>
	<file name="catalog/model/checkout/order.php">
		<operation>
			<search position="after"><![CDATA[$template->data['ip'] = $order_info['ip'];]]></search>
			<add><![CDATA[$template->data['store_address'] = nl2br($this->config->get('config_address'));]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[$text .= $language->get('text_new_footer') . "\n\n";]]></search>
			<add><![CDATA[$orderFileName = 'Objednavka_'.$order_id.'.pdf';
				$dompdf = new DOMPDF();
				$dompdf->load_html($html);
				$dompdf->render();
				$output = $dompdf->output();
				file_put_contents($orderFileName, $output);
				$mail_body = $this->config->get('config_email_body');]]></add>
		</operation>
		<operation>
			<search position="replace" offset="2"><![CDATA[$mail->setHtml($html);]]></search>
			<add><![CDATA[$mail->addAttachment($orderFileName);
				$mail->setHtml($mail_body);
				$mail->setText(html_entity_decode(preg_replace('/(?:<|&lt;).*?(?:>|&gt;)/', '', $mail_body), ENT_QUOTES, 'UTF-8'));
				$mail->send();
				if(file_exists ($orderFileName))
				{
					unlink($orderFileName);
				}]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/mail/order.tpl">
		<operation>
			<search position="replace" offset="60"><![CDATA[<body style="font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: #000000;">]]></search>
			<add><![CDATA[<body style="font-family: DejaVu Sans, sans-serif; font-size: 12px; color: #000000;">
<table style="width: 100%;margin-bottom: 20px;" border="1" cellspacing="0">
	<tr style="border: 1px solid">
		<td style="border: 1px solid; padding: 5px" valign="top">
			<b>Dodávateľ</b>
				<p style="font-size: 12px;  text-align: left; padding-left: 25px; ">
				<?php echo $store_name; ?> <br />
				<?php echo $store_address; ?>
				</p>
				<p>
					<b><?php echo $text_telephone; ?></b>0904 857 224<br />
					<b><?php echo $text_email; ?></b>adorum@gmail.com<br />
					<br />
					<b>IČO: </b>11111111111<br />
					<b>DIČ: </b>22222222222222222<br />
					<br />
					<b>Číslo účtu: </b>1111111111111/0900
					<br /><br />
					Nie som platca DPH.
					<br /><br />
					Vypis z ORSR!!!!!!!!!!!!
				</p>
				<hr />
				<b>Príjemnca</b>
				<p style="font-size: 12px;  text-align: left; padding-left: 25px; "><?php echo $payment_address; ?></p>
				<p>
					<b><?php echo $text_email; ?></b> <?php echo $email; ?><br />
					<b><?php echo $text_telephone; ?></b> <?php echo $telephone; ?>
				</p>
		</td>
		<td style="border: 1px solid; padding: 5px" valign="top">
			<b>IČO odberateľa:</b><br />
				<b>DIČ odberateľa:</b>
				<hr />
				<b>Odberateľ:</b>
				
				<hr />
				<b>Objednávka:</b>
				<p>
					<ul>
						<li><b><?php echo $text_date_added; ?></b> <?php echo $date_added; ?></li>
						<li><b><?php echo $text_payment_method; ?></b> <?php echo $payment_method; ?></li>
						<?php if ($shipping_method) { ?>
						<li><b><?php echo $text_shipping_method; ?></b> <?php echo $shipping_method; ?></li>
						<?php } ?>    
					</ul>
				</p>
		</td>
	</tr>
</table>]]></add>
		</operation>
		<operation>
			<search position="replace" offset="1"><![CDATA[<p style="margin-top: 0px; margin-bottom: 20px;"><?php echo $text_footer; ?></p>]]></search>
			<add><![CDATA[]]></add>
		</operation>
	</file>
</modification>